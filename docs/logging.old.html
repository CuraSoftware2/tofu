<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Logging · Tofu</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Warning"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Logging · Tofu"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.tofu.tf/"/><meta property="og:description" content="# Warning"/><meta property="og:image" content="https://docs.tofu.tf/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.tofu.tf/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/favicon.ico" alt="Tofu"/><h2 class="headerTitleWithLogo">Tofu</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/start" target="_self">Docs</a></li><li class=""><a href="/api/index.html" target="_self">API</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Logging</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="warning"></a><a href="#warning" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Warning</h1>
<p>This page is obsolete. Head on to the [new docs on logging](/docs/logging/tofu.logging.home title: Tofu Logging).</p>
<h2><a class="anchor" aria-hidden="true" id="installation"></a><a href="#installation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2>
<p>Logging are available as a separate project
<code>&quot;tf.tofu&quot; %% &quot;tofu-logging&quot; % tofu-version</code></p>
<h2><a class="anchor" aria-hidden="true" id="motivation"></a><a href="#motivation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
<h3><a class="anchor" aria-hidden="true" id="preface"></a><a href="#preface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preface</h3>
<p>Almost every application nowadays does logging, whether it is logging of business events, history of some state of
application or even debug record sequences. We log to files, distributed systems, standard outputs of OSes, and we got
used to it so much it seems simple to us. Many existing libraries provide many ways of logging from your application's
code, either automatic or manual.</p>
<h3><a class="anchor" aria-hidden="true" id="whats-wrong-and-how-to-fix-that"></a><a href="#whats-wrong-and-how-to-fix-that" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What's wrong (and how to fix that)?</h3>
<p>First, logging is, in fact, a side effect. Whether we log anything to standard output or a file — it's an interaction
with the outside world ('outside' relative to our program). Thus, logging as a process can be represented as an effect
and operations - as an algebra.<br>
Second, logging itself seems easy, but stuff around it - not so much. MDC, contexts, structured logging - all these
things are very helpful on a day-to-day basis, allowing us to read and write our logs, making them clean, comprehensible
and useful for many purposes. But there are few simple ways to provide all this functionality without bleeding and
screaming from seeing over-engineered solutions.<br>
Tofu offers an easy and understandable abstraction over logging (it's even named like this!) but keeping in mind that
logging is an effect that can be composed.<br>
It looks very similar to interfaces we all are used to (from SLF4J and other logging libraries and facades), introducing
some new concepts:</p>
<pre><code class="hljs css language-scala:reset"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">tofu</span><span class="hljs-selector-class">.logging</span><span class="hljs-selector-class">.LoggedValue</span>

<span class="hljs-selector-tag">trait</span> <span class="hljs-selector-tag">Logging</span><span class="hljs-selector-attr">[F[_]</span>] {
  <span class="hljs-selector-tag">def</span> <span class="hljs-selector-tag">trace</span>(<span class="hljs-attribute">message</span>: String, <span class="hljs-attribute">values</span>: LoggedValue*): <span class="hljs-selector-tag">F</span><span class="hljs-selector-attr">[Unit]</span>

  <span class="hljs-selector-tag">def</span> <span class="hljs-selector-tag">debug</span>(<span class="hljs-attribute">message</span>: String, <span class="hljs-attribute">values</span>: LoggedValue*): <span class="hljs-selector-tag">F</span><span class="hljs-selector-attr">[Unit]</span>

  <span class="hljs-selector-tag">def</span> <span class="hljs-selector-tag">info</span>(<span class="hljs-attribute">message</span>: String, <span class="hljs-attribute">values</span>: LoggedValue*): <span class="hljs-selector-tag">F</span><span class="hljs-selector-attr">[Unit]</span>

  <span class="hljs-selector-tag">def</span> <span class="hljs-selector-tag">warn</span>(<span class="hljs-attribute">message</span>: String, <span class="hljs-attribute">values</span>: LoggedValue*): <span class="hljs-selector-tag">F</span><span class="hljs-selector-attr">[Unit]</span>

  <span class="hljs-selector-tag">def</span> <span class="hljs-selector-tag">error</span>(<span class="hljs-attribute">message</span>: String, <span class="hljs-attribute">values</span>: LoggedValue*): <span class="hljs-selector-tag">F</span><span class="hljs-selector-attr">[Unit]</span>
}

</code></pre>
<p>Basically, that's the main user API you can interact with throughout your code. It resembles well-known solutions,
keeping in mind that logging is an effect, though introducing the concept of <code>LoggedValue</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="representation"></a><a href="#representation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Representation</h2>
<p>To represent a value in logs we use a concept of <code>Loggable</code> (it's a typeclass). It describes how a value of some type
can be logged, both as a string representation in log message and as a component of structured logging. Given an
instance of <code>Loggable</code> for a type, a value of the type can be converted into the final internal representation
called <code>LoggedValue</code> and thus logged in a way that you provided.<br>
There are multiple predefined ways to create an instance of <code>Loggable</code>, many of them can be found
in <code>tofu.logging.Loggable</code> object:</p>
<ul>
<li><code>Loggable.empty</code> for no-op logging of value</li>
<li><code>Loggable.show</code> for using <code>cats.Show</code> instance as string representaion</li>
<li><code>Loggable.either</code> for logging either of <code>A</code> and <code>B</code></li>
<li>provided instances for all primitive types, as well as stdlib's collections and collections from Cats</li>
<li>java.time.* instances</li>
</ul>
<p>Of course, you can describe your <code>Loggable</code> instance yourself by extending existing traits that pre-implement some
functionality:</p>
<ul>
<li><code>DictLoggable</code> for multi-field objects</li>
<li><code>ToStringLoggable</code> for using <code>.toString</code> for logging</li>
<li><code>HideLoggable</code> to exclude value from logging</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="loggable-example"></a><a href="#loggable-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Loggable example</h3>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> tofu.logging._
<span class="hljs-keyword">import</span> cats.syntax.semigroup._

<span class="hljs-keyword">case</span> <span class="hljs-keyword">class</span> User(<span class="hljs-keyword">name</span>: String, surname: String)

<span class="hljs-keyword">implicit</span> val userLoggable = new DictLoggable[User] {
  override def fields[I, V, R, S](a: User, i: I)(<span class="hljs-keyword">implicit</span> r: LogRenderer[I, V, R, S]): R = {
    r.addString(<span class="hljs-string">"name"</span>, a.<span class="hljs-keyword">name</span>, i) |+| r.addString(<span class="hljs-string">"surname"</span>, a.surname, i)
  }

  override def logShow(a: User): String = s<span class="hljs-string">"name = ${a.name}, surname = ${a.surname}"</span>
}
</code></pre>
<p>Let's take a look at this example.<br>
First, we define a loggable for our <code>User</code> class as a <code>DictLoggable</code> which means that we want to log it as a multi-field
object with structure.<br>
Second, we define two methods that describe how <code>User</code> should be logged:</p>
<ul>
<li><code>fields</code>, that represents <code>User</code> as a structure, containing two fields with their respective names and values</li>
<li><code>logShow</code>, that represents <code>User</code> as a string in a log message</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="loggable-derivation"></a><a href="#loggable-derivation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Loggable derivation</h2>
<p>a
Tofu has integration with <a href="https://github.com/tofu-tf/derevo">derevo</a> library. It allows you to easily generate
instances of <code>Loggable[YourClass]</code> for case classes or ADTs:</p>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> tofu.logging.derivation.loggable
<span class="hljs-keyword">import</span> derevo.derive

@derive(loggable)
<span class="hljs-keyword">case</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">Query</span>(<span class="hljs-symbol">value: <span class="hljs-symbol">String</span>, <span class="hljs-symbol">size</span>: <span class="hljs-symbol">Int</span>, <span class="hljs-symbol">isTagged</span>: <span class="hljs-symbol">Tagged</span>, <span class="hljs-symbol">tag</span>: <span class="hljs-symbol">Tag</span></span>)

@<span class="hljs-symbol">derive</span>(<span class="hljs-symbol">loggable</span>)
<span class="hljs-symbol">case</span> <span class="hljs-symbol">class</span> <span class="hljs-symbol">Tagged</span>(<span class="hljs-symbol">b: <span class="hljs-symbol">Option</span></span>[<span class="hljs-symbol">Boolean</span>])

@<span class="hljs-symbol">derive</span>(<span class="hljs-symbol">loggable</span>)
<span class="hljs-symbol">sealed</span> <span class="hljs-symbol">trait</span> <span class="hljs-symbol">Tag</span>

@<span class="hljs-symbol">derive</span>(<span class="hljs-symbol">loggable</span>)
<span class="hljs-symbol">case</span> <span class="hljs-symbol">class</span> <span class="hljs-symbol">DatabaseTag</span>(<span class="hljs-symbol">db: <span class="hljs-symbol">String</span></span>) <span class="hljs-symbol">extends</span> <span class="hljs-symbol">Tag</span>

@<span class="hljs-symbol">derive</span>(<span class="hljs-symbol">loggable</span>)
<span class="hljs-symbol">case</span> <span class="hljs-symbol">object</span> <span class="hljs-symbol">InMemoryTag</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">Tag</span>
</code></pre>
<p>so when logged</p>
<h3><a class="anchor" aria-hidden="true" id="configuring-loggable-generation"></a><a href="#configuring-loggable-generation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring Loggable generation</h3>
<p>Tofu has several annotations to configure generation of <code>Loggable</code></p>
<ul>
<li><code>@hidden</code>
<pre><code class="hljs css language-scala:reset"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">tofu</span><span class="hljs-selector-class">.logging</span><span class="hljs-selector-class">.derivation</span>.{<span class="hljs-selector-tag">loggable</span>, <span class="hljs-selector-tag">hidden</span>}
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">derevo</span><span class="hljs-selector-class">.derive</span>

@<span class="hljs-selector-tag">derive</span>(loggable)
<span class="hljs-selector-tag">case</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">User</span>(<span class="hljs-attribute">name</span>: String, <span class="hljs-variable">@hidden</span>() <span class="hljs-attribute">password</span>: String)

</code></pre>
<code>User(&quot;tofu&quot;, &quot;pass&quot;)</code> will be logged as <code>User{name=tofu}</code></li>
<li><code>@masked</code>
<pre><code class="hljs css language-scala:reset"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">tofu</span><span class="hljs-selector-class">.logging</span><span class="hljs-selector-class">.derivation</span>.{<span class="hljs-selector-tag">loggable</span>, <span class="hljs-selector-tag">masked</span>, <span class="hljs-selector-tag">MaskMode</span>}
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">derevo</span><span class="hljs-selector-class">.derive</span>

@<span class="hljs-selector-tag">derive</span>(loggable)
<span class="hljs-selector-tag">case</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Card</span>(<span class="hljs-variable">@masked</span>(MaskMode.Erase) <span class="hljs-attribute">expirationDate</span>: String, <span class="hljs-variable">@masked</span>(MaskMode.ForLength(<span class="hljs-number">4</span>, <span class="hljs-number">12</span>)) <span class="hljs-attribute">cardNumber</span>: String, <span class="hljs-variable">@masked</span>() <span class="hljs-attribute">owner</span>: String)

</code></pre>
<code>Card(737, &quot;1244345632322311&quot;, &quot;TOFU PETROV&quot;)</code> will be logged as <code>Card{expirationDate=...,cardNumber=1244########2311,owner=**** ******}</code></li>
<li><code>@unembed</code>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> tofu.logging.derivation.{loggable, unembed}
<span class="hljs-keyword">import</span> derevo.derive

@derive(loggable)
<span class="hljs-keyword">case</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">Scientist</span>(@<span class="hljs-symbol">unembed</span> <span class="hljs-symbol">owner: <span class="hljs-symbol">Person</span>, <span class="hljs-symbol">age</span>: <span class="hljs-symbol">Option</span></span>[<span class="hljs-symbol">Int</span>])

@<span class="hljs-symbol">derive</span>(<span class="hljs-symbol">loggable</span>)
<span class="hljs-symbol">case</span> <span class="hljs-symbol">class</span> <span class="hljs-symbol">Person</span>(<span class="hljs-symbol">name: <span class="hljs-symbol">String</span></span>)
</code></pre>
<code>Room(Person(&quot;Karl Sagan&quot;), None)</code> will be logged as <code>Room{name=Karl Sagan, age=None}</code></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="creation"></a><a href="#creation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creation</h2>
<p>Creating an instance of <code>Logging</code> in Tofu is an effect itself. You can use helper class <code>Logs</code> that can produce values
of type <code>I[Logging[F]]</code> (where <code>I</code> and <code>F</code> are intended to be two different effects, former is a <code>I</code>nitialization
effect (<code>Task</code> or <code>IO</code>)  and latter is some ReaderT-ish effect or just main program effect type, but they can be the
same though) and define a behaviour of your <code>Logging</code> instances. An instance of <code>Logs</code> is supposed to be shared by
different parts of user code. It's not a restriction though.</p>
<p>Tofu logs are built on top of existing Java logging infrastructure hence each logger for some class needs to have
distinctive name, as well as whole logging system has to be configured with a <code>logback.xml</code> (default configuration does
exist though).</p>
<p><code>Logs</code> methods close the first requirement in different ways:</p>
<h3><a class="anchor" aria-hidden="true" id="plain-logging"></a><a href="#plain-logging" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plain <code>Logging</code></h3>
<ul>
<li>by asking that name from user:
For example here we create named instance and pass it explicitly.</li>
</ul>
<pre><code class="hljs css language-scala:reset">import tofu.logging._
import tofu.syntax.logging._
import tofu.syntax.monadic._
import cats._

class MyService[<span class="hljs-string">F[_</span>] : Monad](logger: Logging[F]) {
  def makeFoo(arg: String): F[Int] =
<span class="hljs-code">    logger.info("Doing simplest thing").as(arg.length) &lt;* logger.debug("Yep, counted length")</span>
}

object MyService {
  def makeNamed[<span class="hljs-string">I[_</span>] : Monad, F[<span class="hljs-string">_</span>] : Monad](logs: Logs[I, F]): I[MyService[F]] =
<span class="hljs-code">    logs.byName("my-service-log").map(new MyService[F](_))</span>
}

</code></pre>
<ul>
<li>by generating that name from type-parameter, which is a class intended to use logging with:</li>
</ul>
<pre><code class="hljs css language-scala:reset">def makeNamed[<span class="hljs-string">I[_</span>] : Monad, F[<span class="hljs-string">_</span>] : Monad](logs: Logs[I, F]): I[MyService[F]] =
  logs.byName("my-service-log").map(new MyService[<span class="hljs-string">F</span>](<span class="hljs-link">_</span>))
</code></pre>
<p>Logging instance created by this method for class <code>MyService[IO]</code> in package <code>com.bar.foo.pckg</code> will be
named <code>com.bar.foo.pckg.MyService</code></p>
<h3><a class="anchor" aria-hidden="true" id="typesafe-servicelogging"></a><a href="#typesafe-servicelogging" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Typesafe <code>ServiceLogging</code></h3>
<p>Creating plain <code>Logging[F]</code> and using it around tends to be error-prune: one can easily pass logger created for
service <code>FooService</code> instead of <code>BarService</code>. Tofu has a solution — newtype <code>ServiceLogging[F, Service]</code>
and <code>LoggingCompanion</code> which contains simple type alias <code>Log[F[_]] = ServiceLogging[F, Service]</code>.</p>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> tofu.logging._
<span class="hljs-keyword">import</span> tofu.syntax.logging._
<span class="hljs-keyword">import</span> tofu.syntax.monadic._
<span class="hljs-keyword">import</span> cats._

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooService</span>[<span class="hljs-type">F</span>[_] </span>: <span class="hljs-type">FooService</span>.<span class="hljs-type">Log</span> : <span class="hljs-type">Monad</span>] {
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">makeFoo</span></span>(arg: <span class="hljs-type">Int</span>): <span class="hljs-type">F</span>[<span class="hljs-type">String</span>] =
    <span class="hljs-string">info"Doing yet another simplest thing"</span>.as(arg.toString) &lt;* <span class="hljs-string">debug"Yep, called toString"</span>
}

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">FooService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LoggingCompanion</span>[<span class="hljs-type">FooService</span>] </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make</span></span>[<span class="hljs-type">I</span>[_] : <span class="hljs-type">Functor</span>, <span class="hljs-type">F</span>[_] : <span class="hljs-type">Monad</span>](logs: <span class="hljs-type">Logs</span>[<span class="hljs-type">I</span>, <span class="hljs-type">F</span>]): <span class="hljs-type">I</span>[<span class="hljs-type">FooService</span>[<span class="hljs-type">F</span>]] =
    logs.of[<span class="hljs-type">FooService</span>].map(<span class="hljs-keyword">implicit</span> l =&gt; <span class="hljs-keyword">new</span> <span class="hljs-type">FooService</span>[<span class="hljs-type">F</span>])
}

</code></pre>
<p>Note that using it like <code>logs.named[&quot;foo&quot;]</code> or <code>logs.byName(&quot;foo&quot;)</code> is going to fail compilation.</p>
<p>This is also the intended way to create <code>Logging[F]</code> or <code>ServiceLogging[F, Service]</code> instance for your classes.</p>
<h3><a class="anchor" aria-hidden="true" id="ways-to-create-logs"></a><a href="#ways-to-create-logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ways to create Logs</h3>
<p>There are multiple ways to create <code>Logs</code> instance, among them:</p>
<ul>
<li><code>Logs.sync</code> that requires a <code>cats.effect.Sync</code> instance for delaying side-effects</li>
<li><code>Logs.withContext</code> that requires a <code>cats.effect.Sync</code> instance for delaying side-effects and a proof that <code>F</code> has a
context to log</li>
<li><code>Logs.const</code> that wraps single <code>Logging</code> thus always returning the same instance</li>
<li><code>Logs.empty</code> that will produce a no-op <code>Logging</code> instances</li>
<li><code>Logs.combine</code> that combines two instances of <code>Logs</code>.
<code>Logging</code> instance that is created this way will be a combination of two underlying instances, produced by both <code>Logs</code>
. This means that both <code>Logging</code> implementations will be called in sequence</li>
</ul>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> tofu.logging._

<span class="hljs-comment">// for simplification, you can use whatever F you like</span>
<span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">F</span>[<span class="hljs-type">A</span>] </span>= cats.effect.<span class="hljs-type">IO</span>[<span class="hljs-type">A</span>]

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyService</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTaglessService</span>[<span class="hljs-type">F</span>[_]]</span>
<span class="hljs-comment">// defines simple logging behaviour without any notion of contexts</span>
<span class="hljs-keyword">val</span> syncLogs = <span class="hljs-type">Logs</span>.sync[<span class="hljs-type">F</span>, <span class="hljs-type">F</span>]

<span class="hljs-comment">// describing creation of logging instances and logging itself. When being run, this will log a message</span>
<span class="hljs-keyword">val</span> effect: <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-keyword">for</span> {
  loggingBN &lt;- syncLogs.byName(<span class="hljs-string">"my-logger"</span>) <span class="hljs-comment">// you can create instances by name</span>
  loggingFS &lt;- syncLogs.forService[<span class="hljs-type">MyService</span>] <span class="hljs-comment">// you can create instances by type of your non-tagless-final services</span>
  loggingFS &lt;- syncLogs.of[<span class="hljs-type">MyTaglessService</span>] <span class="hljs-comment">// you can create instances by type of your tagless-final services</span>
  _ &lt;- loggingBN.info(<span class="hljs-string">"This is an INFO message"</span>)
  _ &lt;- loggingFS.warn(<span class="hljs-string">"This is a WARN message"</span>)
} <span class="hljs-keyword">yield</span> ()
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="context-logging"></a><a href="#context-logging" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context logging</h2>
<p>It is possible to log the context of your computations along with actual log message. Often it comes along with
structured logging. To illustrate it consider this pseudocode:</p>
<pre><code class="hljs">structuredLogger.info(<span class="hljs-string">"I am a message"</span>, context = Map(<span class="hljs-string">"transaction_id"</span> -&gt; <span class="hljs-number">2342234</span>, <span class="hljs-string">"request_name"</span> -&gt; <span class="hljs-string">"req"</span>))
<span class="hljs-comment">//it logs </span>
{ <span class="hljs-string">"level"</span>: <span class="hljs-string">"INFO"</span>, <span class="hljs-string">"message"</span>: <span class="hljs-string">"I am a message"</span>, <span class="hljs-string">"transaction_id"</span>: <span class="hljs-number">2342234</span>, <span class="hljs-string">"request_name"</span>: <span class="hljs-string">"req"</span> }
</code></pre>
<p>That's neat, right? But it is verbose and clumsy to use, so tofu provides an abstraction for it.</p>
<p>If you have an instance of <code>tofu.Context</code> for your effect type and a <code>Loggable</code> for your context, you can have it logged
automagically. That is natural — describe how we can get a context from a computation <code>F</code> and a way to represent that
context in log, and we will ensure it will be logged anytime you use <code>Logging</code> operations. You can log that context to
string as well as use it as a part of structured logging.</p>
<h3><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h3>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> tofu.<span class="hljs-type">WithRun</span>
<span class="hljs-keyword">import</span> tofu.logging.derivation.loggable._
<span class="hljs-keyword">import</span> tofu.logging.{<span class="hljs-type">LoggableContext</span>, <span class="hljs-type">Logging</span>, <span class="hljs-type">LoggingCompanion</span>, <span class="hljs-type">Logs</span>}
<span class="hljs-keyword">import</span> cats.{<span class="hljs-type">Functor</span>, <span class="hljs-type">Monad</span>}
<span class="hljs-keyword">import</span> tofu.syntax.console._
<span class="hljs-keyword">import</span> tofu.syntax.context._
<span class="hljs-keyword">import</span> tofu.syntax.logging._
<span class="hljs-keyword">import</span> tofu.syntax.monadic._
<span class="hljs-keyword">import</span> tofu.zioInstances.implicits._
<span class="hljs-keyword">import</span> zio._
<span class="hljs-keyword">import</span> zio.interop.catz._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Example</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">zio</span>.<span class="hljs-title">App</span> </span>{

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusinessService</span>[<span class="hljs-type">F</span>[_] </span>: <span class="hljs-type">BusinessService</span>.<span class="hljs-type">Log</span> : <span class="hljs-type">Monad</span>] {
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logic</span></span>(arg: <span class="hljs-type">String</span>): <span class="hljs-type">String</span> = arg.repeat(<span class="hljs-number">3</span>).replace(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">runLogic</span></span>(arg: <span class="hljs-type">String</span>): <span class="hljs-type">F</span>[<span class="hljs-type">String</span>] =
      <span class="hljs-string">info"Doing some business logic"</span> as logic(arg)
  }

  <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">BusinessService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LoggingCompanion</span>[<span class="hljs-type">BusinessService</span>] </span>{

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make</span></span>[<span class="hljs-type">I</span>[_] : <span class="hljs-type">Functor</span>, <span class="hljs-type">F</span>[_] : <span class="hljs-type">Monad</span>](logs: <span class="hljs-type">Logs</span>[<span class="hljs-type">I</span>, <span class="hljs-type">F</span>]): <span class="hljs-type">I</span>[<span class="hljs-type">BusinessService</span>[<span class="hljs-type">F</span>]] =
      logs
        .of[<span class="hljs-type">BusinessService</span>]
        .map(<span class="hljs-keyword">implicit</span> l =&gt; <span class="hljs-keyword">new</span> <span class="hljs-type">BusinessService</span>[<span class="hljs-type">F</span>])
  }

  <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestContext</span>(<span class="hljs-params">id: <span class="hljs-type">Long</span>, method: <span class="hljs-type">String</span></span>)</span>

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span>[<span class="hljs-type">I</span>[_] </span>: <span class="hljs-type">Monad</span> : <span class="hljs-type">Logging</span>, <span class="hljs-type">F</span>[_] : <span class="hljs-type">WithRun</span>[*[_], <span class="hljs-type">I</span>, <span class="hljs-type">RequestContext</span>]](
                                                                                 business: <span class="hljs-type">BusinessService</span>[<span class="hljs-type">F</span>]
                                                                               ) {

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handleRequest</span></span>(request: <span class="hljs-type">Server</span>.<span class="hljs-type">Request</span>): <span class="hljs-type">I</span>[<span class="hljs-type">Server</span>.<span class="hljs-type">Response</span>] = <span class="hljs-keyword">for</span> {
      _ &lt;- <span class="hljs-string">info"Got request <span class="hljs-subst">$request</span>"</span>
      context = <span class="hljs-type">RequestContext</span>(request.id, request.method)
      logicComputation = business.runLogic(request.body)

      result &lt;- runContext[<span class="hljs-type">F</span>](logicComputation)(context)

      response = <span class="hljs-type">Server</span>.<span class="hljs-type">Response</span>(result)
      _ &lt;- <span class="hljs-string">info"Got response <span class="hljs-subst">$response</span>"</span>
    } <span class="hljs-keyword">yield</span> response

  }

  <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Server</span> </span>{

    <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">id: <span class="hljs-type">Long</span>, body: <span class="hljs-type">String</span>, method: <span class="hljs-type">String</span></span>)</span>

    <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Response</span>(<span class="hljs-params">answer: <span class="hljs-type">String</span></span>)</span>

  }

  <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Contextual</span>[<span class="hljs-type">A</span>] </span>= <span class="hljs-type">RIO</span>[<span class="hljs-type">RequestContext</span>, <span class="hljs-type">A</span>]

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">URIO</span>[<span class="hljs-type">ZEnv</span>, <span class="hljs-type">ExitCode</span>] = {
    <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> loggableContext: <span class="hljs-type">LoggableContext</span>[<span class="hljs-type">Contextual</span>] =
      <span class="hljs-type">LoggableContext</span>.of[<span class="hljs-type">Contextual</span>].instance[<span class="hljs-type">RequestContext</span>]
    <span class="hljs-keyword">val</span> contextLogs: <span class="hljs-type">Logs</span>[<span class="hljs-type">Task</span>, <span class="hljs-type">Contextual</span>] = <span class="hljs-type">Logs</span>.withContext[<span class="hljs-type">Task</span>, <span class="hljs-type">Contextual</span>]
    <span class="hljs-keyword">val</span> mainLogs: <span class="hljs-type">Logs</span>[<span class="hljs-type">Task</span>, <span class="hljs-type">Task</span>] = <span class="hljs-type">Logs</span>.sync[<span class="hljs-type">Task</span>, <span class="hljs-type">Task</span>]

    <span class="hljs-keyword">for</span> {
      implicit0(mainLogging: <span class="hljs-type">Logging</span>[<span class="hljs-type">Task</span>]) &lt;- mainLogs.byName(<span class="hljs-string">"main"</span>)
      bs &lt;- <span class="hljs-type">BusinessService</span>.make(contextLogs)
      server = <span class="hljs-keyword">new</span> <span class="hljs-type">Server</span>[<span class="hljs-type">Task</span>, <span class="hljs-type">Contextual</span>](bs)
      userRequest &lt;- readRequest
      response &lt;- server.handleRequest(userRequest)
      _ &lt;- putStrLn[<span class="hljs-type">Task</span>](<span class="hljs-string">s"Got response <span class="hljs-subst">$response</span>"</span>)
    } <span class="hljs-keyword">yield</span> ()

  }.catchAll(_ =&gt; <span class="hljs-type">URIO</span>.unit).as(zio.<span class="hljs-type">ExitCode</span>.success)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readRequest</span></span>: <span class="hljs-type">Task</span>[<span class="hljs-type">Server</span>.<span class="hljs-type">Request</span>] =
    (
      readStrLn[<span class="hljs-type">Task</span>]
        .map(_.toLongOption)
        .someOrFail(<span class="hljs-keyword">new</span> <span class="hljs-type">Exception</span>(<span class="hljs-string">"Please provide numeric id"</span>)),
      readStrLn[<span class="hljs-type">Task</span>],
      readStrLn[<span class="hljs-type">Task</span>]
      ).mapN(<span class="hljs-type">Server</span>.<span class="hljs-type">Request</span>.apply)

}

</code></pre>
<h4><a class="anchor" aria-hidden="true" id="business-logic"></a><a href="#business-logic" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Business Logic</h4>
<p>We got <code>BusinessService</code> as our business logic. It does some stuff but most importantly it does not know it has any kind
of special logging. It just logs some stuff and all it needs for it is <code>Logging</code> instance.</p>
<p>As you can see it is created with the same factory-pattern as discussed before.</p>
<h4><a class="anchor" aria-hidden="true" id="server"></a><a href="#server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server</h4>
<p>Next we have a <code>Server</code> of some kind that should get some request, run some business logic on it and then return
response. Also, we want to have all the logs that business logic produces to have special RequestContext in it. To
achieve this we run the logic in special contextual effect type <code>F</code> which then can be evaluated into our main effect <code>I</code>
.
(More information on this can be found in scaladoc for <code>tofu.WithRun</code> etc.)
Moreover <code>Server</code> itself logs some messages and requires its own instance of <code>Logging</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="loggable-derivation-1"></a><a href="#loggable-derivation-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Loggable derivation</h4>
<p>As one can see in <a href="#representation">Representation part</a> for any of those logged values (like <code>$request</code>)  <code>Loggable</code>
instance should be in scope. In the example they are generated by macro, we just need to import it:</p>
<pre><code class="hljs css language-scala"> <span class="hljs-keyword">import</span> tofu.logging.derivation.loggable._
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="running"></a><a href="#running" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running</h4>
<p>It is a simple ZIO-app that reads user input from console and passes it to server. So when running possible output will
look like this, if ran with <code>ConsoleContextLayout</code> in <code>logback.xml</code>:</p>
<pre><code class="hljs css language-bash">sbt&gt;run
10102
foo bar body
GET
23:20:14 INFO  main - Got request Request{id=10102,body=foo bar body,method=GET}
23:20:14 INFO  c.t.c.n.c.Example<span class="hljs-variable">$BusinessService</span> - Doing some business logic
 [method=GET, id=10102]
23:20:14 INFO  main - Got response Response{answer=foo bbr bodyfoo bbr bodyfoo bbr body}
Got response Response(foo bbr bodyfoo bbr bodyfoo bbr body)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="syntax-extensions"></a><a href="#syntax-extensions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Syntax extensions</h2>
<p>It's much more convenient to use pre-defined syntax extensions for logging operations since they do all heavy lifting
for you:</p>
<pre><code class="hljs css language-scala:reset"><span class="hljs-keyword">import</span> cats.effect._
<span class="hljs-keyword">import</span> cats.syntax.functor._
<span class="hljs-keyword">import</span> cats.{Monad, Show, Functor}
<span class="hljs-keyword">import</span> tofu.logging._
<span class="hljs-keyword">import</span> tofu.syntax.logging._

<span class="hljs-keyword">case</span> <span class="hljs-keyword">class</span> User(<span class="hljs-keyword">name</span>: String, surname: String)
object User {
  <span class="hljs-keyword">implicit</span> val userShow: Show[User]         = user =&gt; s<span class="hljs-string">"name=${user.name}, surname=${user.surname}"</span>
  <span class="hljs-keyword">implicit</span> val userInstance: Loggable[User] = Loggable.show
}

val user: User = User(<span class="hljs-string">"name"</span>, <span class="hljs-string">"surname"</span>)

<span class="hljs-keyword">class</span> MyService[F[_]: Logging: Monad] {
  def doLogging: F[<span class="hljs-keyword">Unit</span>] =
    for {
      _ &lt;- info<span class="hljs-string">"This is a syntax demo: $user"</span>
    } yield ()
}

object MyService {
  def apply[I[_]: Functor, F[_]: Monad](<span class="hljs-keyword">implicit</span> logs: Logs[I, F]): I[MyService[F]] = {
    logs.forService[MyService[F]].map(<span class="hljs-keyword">implicit</span> l =&gt; new MyService[F])
  }
}

// An instance of `Logs` is supposed to be shared between mupltiple classes (or a single one for a whole application)
// Note that initializing effect of your application may differ from logging effect.
<span class="hljs-keyword">implicit</span> val logs: Logs[IO, IO] = Logs.sync[IO, IO]

val io: IO[<span class="hljs-keyword">Unit</span>] = for {
  service &lt;- MyService[IO, IO]
  _       &lt;- service.doLogging
} yield ()

io.unsafeRunSync()
// <span class="hljs-number">13</span>:<span class="hljs-number">56</span>:<span class="hljs-number">26.918</span> [main] INFO tofu.logging.Test$MyService - This is a syntax demo: <span class="hljs-keyword">name</span>=<span class="hljs-keyword">name</span>, surname=surname
</code></pre>
<p>Using a syntax we achieve a few important goals.<br>
First, it will log a message containing a string representation of your value of type <code>User</code> as you defined it
in <code>Loggable</code> instance.<br>
Second, it will create a <code>LoggedValue</code> from your <code>Loggable</code> description and pass it to underlying logger and
your <code>LogRendered</code>, so your structured logging will work as expected.</p>
<h2><a class="anchor" aria-hidden="true" id="integration-with-logs4cats"></a><a href="#integration-with-logs4cats" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integration with logs4cats</h2>
<p>There is a library for effectual logging named <a href="https://github.com/typelevel/log4cats">log4cats</a> which shares
the goal of representing logging as an effect and providing the ability to log context values. It is used by some of the
open-source libraries which may require you to pass an instance of <code>org.typelevel.log4cats.Logger</code> to it in order to
log something. Module <code>tofu-logging-log4cats</code> contains a helper that can create an instance of log4cats <code>Logger</code> from
our existing
<code>tofu.logging.Logging</code> one. If our <code>Logging</code> instance is contextual, it will continue leveraging that despite being
wrapped in log4cats <code>Logger</code>. Moveover, it will log context values that are passed to log4cats <code>Logger</code> API
as <code>Map[String, String]</code>.<br>
This means that not only you will not lose your context, but additional values that are passed to <code>Logger</code> will also be
logged.<br>
Let's take a look at the example:</p>
<pre><code class="hljs css language-scala:reset">import org.typelevel.log4cats.{Logger, StructuredLogger}
import tofu.env.Env
import tofu.logging.<span class="hljs-symbol">_</span>

// Suppose we have <span class="hljs-built_in">some</span> external APIs that leverage log4cats's Logger <span class="hljs-keyword">and</span> StructuredLogger
def logWithLog4Cats[F[<span class="hljs-symbol">_</span>]](<span class="hljs-built_in">implicit</span> logger: Logger[F]): F[Unit] =
    logger.info(<span class="hljs-string">"Hello Tofu!"</span>)

def logWithLog4CatsContextual[F[<span class="hljs-symbol">_</span>]](<span class="hljs-built_in">implicit</span> logger: StructuredLogger[F]): F[Unit] =
    logger.info(Map(<span class="hljs-string">"field"</span> -&gt; <span class="hljs-string">"value"</span>))(<span class="hljs-string">"Hello contextual Tofu!"</span>)

// And we have our own <span class="hljs-built_in">context</span> that can be logged as a structure
case class Context(start: Long)
object Context {
  <span class="hljs-built_in">implicit</span> val loggable: Loggable[Context] = <span class="hljs-built_in">new</span> DictLoggable[Context] {
    override def fields[I, V, R, S](a: Context, i: I)(<span class="hljs-built_in">implicit</span> r: LogRenderer[I, V, R, S]): R =
      r.addInt(<span class="hljs-string">"start"</span>, a.start.toInt, i)
    override def logShow(a: Context): String                                                  =
      a.toString
  }
}

// This <span class="hljs-built_in">context</span> will be embedded <span class="hljs-keyword">in</span> our Env monad <span class="hljs-keyword">and</span> be logged <span class="hljs-built_in">at</span> each logging call
type AppEnv[A] = Env[Context, A]
<span class="hljs-built_in">implicit</span> val loggableContext: LoggableContext[AppEnv] = LoggableContext.of[AppEnv].instance
val logs: Logs[AppEnv, AppEnv]                        = Logs.withContext[AppEnv, AppEnv]

// <span class="hljs-built_in">first</span> we need to import converter function
import tofu.logging.log4cats.<span class="hljs-symbol">_</span>
 
// <span class="hljs-keyword">then</span> we can create an instance of Logger, passing an instance of tofu.logging.Logging implicitly
val env1: AppEnv[Unit] =
  logs.byName(<span class="hljs-string">"Main"</span>).flatMap { <span class="hljs-built_in">implicit</span> logging =&gt;
    <span class="hljs-built_in">implicit</span> val log4catsLogger: StructuredLogger[AppEnv] = toLog4CatsLogger
    logWithLog4Cats *&gt; logWithLog4CatsContextual
  }

// <span class="hljs-keyword">or</span> passing it explicitly <span class="hljs-keyword">in</span> case you have more than one Logging instance <span class="hljs-keyword">in</span> scope
val env2: AppEnv[Unit] =
  logs.byName(<span class="hljs-string">"Main"</span>).flatMap { logging =&gt;
    <span class="hljs-built_in">implicit</span> val log4catsLogger: StructuredLogger[AppEnv] = toLog4CatsLogger(logging)
    logWithLog4Cats *&gt; logWithLog4CatsContextual
  }

// you can also create an instance of Logger <span class="hljs-keyword">for</span> each call, but this <span class="hljs-built_in">is</span> <span class="hljs-keyword">not</span> advised since it will make unnecessary allocations
val env3: AppEnv[Unit] =
  logs.byName(<span class="hljs-string">"Main"</span>).flatMap(<span class="hljs-built_in">implicit</span> logging =&gt; logWithLog4Cats *&gt; logWithLog4CatsContextual)

// we can <span class="hljs-keyword">then</span> import Scheduler <span class="hljs-keyword">and</span> run our Env with <span class="hljs-built_in">some</span> <span class="hljs-built_in">context</span>
import monix.execution.Scheduler.Implicits.global

(<span class="hljs-keyword">for</span> {
  <span class="hljs-symbol">_</span> &lt;- env1.run(Context(<span class="hljs-number">123</span>))
  <span class="hljs-symbol">_</span> &lt;- env2.run(Context(<span class="hljs-number">456</span>))
  <span class="hljs-symbol">_</span> &lt;- env3.run(Context(<span class="hljs-number">789</span>))
} yield ()).runSyncUnsafe(Duration.Inf)

// If we have a configured layout <span class="hljs-keyword">for</span> structured logging, supporting <span class="hljs-built_in">context</span> <span class="hljs-built_in">values</span> (i.e. tofu.logging.ElkLayout)
// we will see JSON logs that contain <span class="hljs-keyword">not</span> only <span class="hljs-built_in">values</span> from our Context, but also <span class="hljs-built_in">values</span> that were passed to log4cats Logger by the external API
// {<span class="hljs-string">"@timestamp"</span>:<span class="hljs-string">"2020-10-31T14:11:31.059Z"</span>,<span class="hljs-string">"loggerName"</span>:<span class="hljs-string">"Main"</span>,<span class="hljs-string">"threadName"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-string">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"Hello Tofu!"</span>,<span class="hljs-string">"start"</span>:<span class="hljs-number">123</span>}
// {<span class="hljs-string">"@timestamp"</span>:<span class="hljs-string">"2020-10-31T14:11:31.167Z"</span>,<span class="hljs-string">"loggerName"</span>:<span class="hljs-string">"Main"</span>,<span class="hljs-string">"threadName"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-string">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"Hello contextual Tofu!"</span>,<span class="hljs-string">"start"</span>:<span class="hljs-number">123</span>,<span class="hljs-string">"field"</span>:<span class="hljs-string">"value"</span>}
// {<span class="hljs-string">"@timestamp"</span>:<span class="hljs-string">"2020-10-31T14:11:31.168Z"</span>,<span class="hljs-string">"loggerName"</span>:<span class="hljs-string">"Main"</span>,<span class="hljs-string">"threadName"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-string">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"Hello Tofu!"</span>,<span class="hljs-string">"start"</span>:<span class="hljs-number">456</span>}
// {<span class="hljs-string">"@timestamp"</span>:<span class="hljs-string">"2020-10-31T14:11:31.168Z"</span>,<span class="hljs-string">"loggerName"</span>:<span class="hljs-string">"Main"</span>,<span class="hljs-string">"threadName"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-string">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"Hello contextual Tofu!"</span>,<span class="hljs-string">"start"</span>:<span class="hljs-number">456</span>,<span class="hljs-string">"field"</span>:<span class="hljs-string">"value"</span>}
// {<span class="hljs-string">"@timestamp"</span>:<span class="hljs-string">"2020-10-31T14:11:31.169Z"</span>,<span class="hljs-string">"loggerName"</span>:<span class="hljs-string">"Main"</span>,<span class="hljs-string">"threadName"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-string">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"Hello Tofu!"</span>,<span class="hljs-string">"start"</span>:<span class="hljs-number">789</span>}
// {<span class="hljs-string">"@timestamp"</span>:<span class="hljs-string">"2020-10-31T14:11:31.169Z"</span>,<span class="hljs-string">"loggerName"</span>:<span class="hljs-string">"Main"</span>,<span class="hljs-string">"threadName"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-string">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"Hello contextual Tofu!"</span>,<span class="hljs-string">"start"</span>:<span class="hljs-number">789</span>,<span class="hljs-string">"field"</span>:<span class="hljs-string">"value"</span>}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#installation">Installation</a></li><li><a href="#motivation">Motivation</a><ul class="toc-headings"><li><a href="#preface">Preface</a></li><li><a href="#whats-wrong-and-how-to-fix-that">What's wrong (and how to fix that)?</a></li></ul></li><li><a href="#representation">Representation</a><ul class="toc-headings"><li><a href="#loggable-example">Loggable example</a></li></ul></li><li><a href="#loggable-derivation">Loggable derivation</a><ul class="toc-headings"><li><a href="#configuring-loggable-generation">Configuring Loggable generation</a></li></ul></li><li><a href="#creation">Creation</a><ul class="toc-headings"><li><a href="#plain-logging">Plain <code>Logging</code></a></li><li><a href="#typesafe-servicelogging">Typesafe <code>ServiceLogging</code></a></li><li><a href="#ways-to-create-logs">Ways to create Logs</a></li></ul></li><li><a href="#context-logging">Context logging</a><ul class="toc-headings"><li><a href="#example">Example</a></li></ul></li><li><a href="#syntax-extensions">Syntax extensions</a></li><li><a href="#integration-with-logs4cats">Integration with logs4cats</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.ico" alt="Tofu" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/start.html">Getting Started</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/tofu" target="tofu" rel="noreferrer noopener">Stack Overflow</a><a href="https://t.me/tofu_scala">Telegram Group (EN|RU)</a><a href="https://gitter.im/tinkoff-tofu/community">Gitter Group (EN)</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/tofu-tf/tofu">GitHub</a><a class="github-button" href="https://github.com/tofu-tf/tofu" data-icon="octicon-star" data-count-href="/TinkoffCreditSystems/tofu/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2021 Tinkoff.ru</section></footer></div></body></html>